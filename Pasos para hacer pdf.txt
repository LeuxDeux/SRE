# 游닄 Gu칤a de Desarrollo - SRE

## 游닎 Env칤o de Emails con PDF
## Pregunta PROMPT: "En el archivo EventoDetail.jsx hay un handleGenerarPDF, que al tocar un bot칩n genera el pdf con el codigo de utils/pdfGenerator.js, 
si quisiera hacer que en mi EventoForm.jsx, cuando se registre correctamente un nuevo Evento, genere el pdf y lo env칤e a un correo, como podr칤a hacer?
Ten en cuenta que se separa routes y controllers, en routes solamente se coloca ruta y la logica en un controller separado"
Archivos a tener en cuenta:
api.js, server.js, eventosController.js, EventoDetail.jsx, EventoForm.jsx
### Implementaci칩n del sistema de emails

**Archivos involucrados:**
- `backend/controllers/emailController.js` - Controlador de emails
- `backend/routes/email.js` - Rutas de email
- `backend/server.js` - Registro de rutas
- `backend/temp/` - Carpeta para PDFs temporales (ocional)
- `frontend/services/api.js` - Servicio emailAPI
- `frontend/components/EventoForm.jsx` - Llamada al servicio

### Pasos de implementaci칩n:

1. **Instalar nodemailer:**
   \`npm install nodemailer\`

2. **Configurar .env:**
   \`\`\`
   SMTP_HOST=smtp.gmail.com
   SMTP_PORT=587
   SMTP_SECURE=false
   EMAIL_USER=tu_correo@gmail.com
   EMAIL_PASSWORD=contrase침a_app
   \`\`\`

3. **Crear carpeta temporal:**
   \`mkdir backend/temp\`

### Flujo completo:
- EventoForm env칤a evento al backend o EventoForm.jsx llama `eventosAPI.crear()
- Backend crea evento en BD o eventosController.crearEvento() registra en BD
- Frontend llama emailAPI.enviarEventoPDF(evento, destinatario)
- EmailController genera PDF y lo env칤a por SMTP
- Se elimina archivo temporal

### Controllers
- Cada controller tiene funciones auxiliares al inicio (ej: `detectarCambios`)
- Siempre incluir try/catch con logging
- Registrar cambios en `historial_eventos` para auditor칤a

### Routes
- Rutas protegidas usan `authMiddleware`
- Respuestas consistentes: `{ success, data/error, message }`

### Frontend
- Servicios API en `src/services/api.js`
- Interceptores autom치ticos para token JWT
- Manejo de 401 expulsa token y dispara evento `tokenExpired`

## 游닍 Dependencias principales
- nodemailer (emails)
- pdfkit (generaci칩n PDFs)
- axios (HTTP client)
- express-jwt (autenticaci칩n)

## 游댕 Archivos clave
- `/backend/controllers/eventosController.js` - Gesti칩n de eventos
- `/backend/controllers/emailController.js` - Env칤o de emails
- `/frontend/services/api.js` - Cliente HTTP centralizado
- `/frontend/components/EventoDetail.jsx` - Visualizaci칩n de eventos

### Notas importantes:
- Gmail requiere contrase침a de aplicaci칩n (no la normal)
- Generar en: myaccount.google.com/apppasswords
- Para UTN, contactar TI para credenciales oficiales
\`\`\`
